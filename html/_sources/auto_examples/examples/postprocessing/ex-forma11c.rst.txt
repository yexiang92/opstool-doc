
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\examples\postprocessing\ex-forma11c.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_examples_postprocessing_ex-forma11c.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_examples_postprocessing_ex-forma11c.py:


Modal analysis of a cooling tower
===================================

.. GENERATED FROM PYTHON SOURCE LINES 7-9

To OpenSeesPy Model
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 9-13

.. code-block:: Python

    import openseespy.opensees as ops

    import opstool as opst








.. GENERATED FROM PYTHON SOURCE LINES 14-21

.. code-block:: Python

    ops.wipe()
    ops.model("basic", "-ndm", 3, "-ndf", 6)
    E, nu, rho = 2.76e10, 0.166, 2244.0  # Pa, kg/m3
    ops.nDMaterial("ElasticIsotropic", 1, E, nu, rho)
    secTag = 11
    ops.section("PlateFiber", secTag, 1, 0.305)








.. GENERATED FROM PYTHON SOURCE LINES 22-23

Read gmsh

.. GENERATED FROM PYTHON SOURCE LINES 23-26

.. code-block:: Python

    GMSH2OPS = opst.pre.Gmsh2OPS(ndm=3, ndf=6)
    GMSH2OPS.read_gmsh_file("utils/forma11c.msh")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Info:: 1 Physical Names.
    Info:: 1821 Nodes; MaxNodeTag 1821; MinNodeTag 1.
    Info:: 2009 Elements; MaxEleTag 2009; MinEleTag 1.
    Info:: Geometry Information >>>
    53 Entities: 37 Point; 12 Curves; 4 Surfaces; 0 Volumes.

    Info:: Physical Groups Information >>>
    1 Physical Groups.
    Physical Group names: ['Boundary']

    Info:: Mesh Information >>>
    1821 Nodes; MaxNodeTag 1821; MinNodeTag 1.
    1972 Elements; MaxEleTag 2009; MinEleTag 1.





.. GENERATED FROM PYTHON SOURCE LINES 27-28

Create OpenSeesPy node commands based on all nodes defined in the GMSH file

.. GENERATED FROM PYTHON SOURCE LINES 28-30

.. code-block:: Python

    node_tags = GMSH2OPS.create_node_cmds()








.. GENERATED FROM PYTHON SOURCE LINES 31-34

.. code-block:: Python

    dim_entity_tags = GMSH2OPS.get_dim_entity_tags()
    dim_entity_tags_2D = [item for item in dim_entity_tags if item[0] == 2]








.. GENERATED FROM PYTHON SOURCE LINES 35-36

Create OpenSeesPy element commands for specific entities

.. GENERATED FROM PYTHON SOURCE LINES 36-42

.. code-block:: Python

    ele_tags_n4 = GMSH2OPS.create_element_cmds(
        ops_ele_type="ASDShellQ4",  # OpenSeesPy element type
        ops_ele_args=[secTag],  # Additional arguments for the element (e.g., section tag)
        dim_entity_tags=dim_entity_tags_2D,
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using ASDShellQ4 - Developed by: Massimo Petracca, Guido Camata, ASDEA Software Technology




.. GENERATED FROM PYTHON SOURCE LINES 43-44

Apply boundary conditions

.. GENERATED FROM PYTHON SOURCE LINES 44-49

.. code-block:: Python

    boundary_dim_tags = GMSH2OPS.get_boundary_dim_tags(physical_group_names="Boundary", include_self=True)
    print(boundary_dim_tags)
    fix_ntags = GMSH2OPS.create_fix_cmds(dim_entity_tags=boundary_dim_tags, dofs=[1] * 6)
    removed_node_tags = opst.pre.remove_void_nodes()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [(0, 55), (0, 59), (0, 61), (0, 63), (1, 6), (1, 9), (1, 12), (1, 15)]
    Info:: Free nodes with tags [57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85] have been removed!




.. GENERATED FROM PYTHON SOURCE LINES 50-51

Visualize the model

.. GENERATED FROM PYTHON SOURCE LINES 51-53

.. code-block:: Python

    opst.vis.pyvista.plot_model(show_outline=True).show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_001.png
        :alt: ex forma11c
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-forma11c_001.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 54-55

Modal analysis

.. GENERATED FROM PYTHON SOURCE LINES 55-59

.. code-block:: Python

    opst.post.save_eigen_data(odb_tag="eigen", mode_tag=60)
    fig = opst.vis.pyvista.plot_eigen(mode_tags=12, odb_tag="eigen", subplots=True)
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_002.png
        :alt: ex forma11c
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_002.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-forma11c_002.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using DomainModalProperties - Developed by: Massimo Petracca, Guido Camata, ASDEA Software Technology
    OPSTOOL ::  Eigen data has been saved to G:\opstool\docs\.opstool.output/EigenData-eigen.zarr!
    OPSTOOL ::  Loading eigen data from G:\opstool\docs\.opstool.output/EigenData-eigen.zarr ...




.. GENERATED FROM PYTHON SOURCE LINES 60-61

Modal Properties

.. GENERATED FROM PYTHON SOURCE LINES 61-65

.. code-block:: Python

    modal_props, eigen_vectors = opst.post.get_eigen_data(odb_tag="eigen")
    modal_props = modal_props.to_pandas()
    modal_props.head()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading eigen data from G:\opstool\docs\.opstool.output/EigenData-eigen.zarr ...


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th>Properties</th>
          <th>eigenLambda</th>
          <th>eigenOmega</th>
          <th>eigenFrequency</th>
          <th>eigenPeriod</th>
          <th>partiFactorMX</th>
          <th>partiFactorMY</th>
          <th>partiFactorRMZ</th>
          <th>partiFactorMZ</th>
          <th>partiFactorRMX</th>
          <th>partiFactorRMY</th>
          <th>partiMassMX</th>
          <th>partiMassMY</th>
          <th>partiMassRMZ</th>
          <th>partiMassMZ</th>
          <th>partiMassRMX</th>
          <th>partiMassRMY</th>
          <th>partiMassesCumuMX</th>
          <th>partiMassesCumuMY</th>
          <th>partiMassesCumuRMZ</th>
          <th>partiMassesCumuMZ</th>
          <th>partiMassesCumuRMX</th>
          <th>partiMassesCumuRMY</th>
          <th>partiMassRatiosMX</th>
          <th>partiMassRatiosMY</th>
          <th>partiMassRatiosRMZ</th>
          <th>partiMassRatiosMZ</th>
          <th>partiMassRatiosRMX</th>
          <th>partiMassRatiosRMY</th>
          <th>partiMassRatiosCumuMX</th>
          <th>partiMassRatiosCumuMY</th>
          <th>partiMassRatiosCumuRMZ</th>
          <th>partiMassRatiosCumuMZ</th>
          <th>partiMassRatiosCumuRMX</th>
          <th>partiMassRatiosCumuRMY</th>
        </tr>
        <tr>
          <th>modeTags</th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>1</th>
          <td>51.13809</td>
          <td>7.151090</td>
          <td>1.138131</td>
          <td>0.878633</td>
          <td>2.133296e-10</td>
          <td>6.395783e-11</td>
          <td>-5.687698e-10</td>
          <td>2.489633e-11</td>
          <td>-2.639758e-10</td>
          <td>6.281351e-09</td>
          <td>4.550953e-20</td>
          <td>4.090604e-21</td>
          <td>3.234991e-19</td>
          <td>6.198272e-22</td>
          <td>6.968322e-20</td>
          <td>3.945537e-17</td>
          <td>4.550953e-20</td>
          <td>4.090604e-21</td>
          <td>3.234991e-19</td>
          <td>6.198272e-22</td>
          <td>6.968322e-20</td>
          <td>3.945537e-17</td>
          <td>1.869924e-25</td>
          <td>1.680773e-26</td>
          <td>7.347386e-28</td>
          <td>2.546785e-27</td>
          <td>1.156468e-28</td>
          <td>6.548041e-26</td>
          <td>1.869924e-25</td>
          <td>1.680773e-26</td>
          <td>7.347386e-28</td>
          <td>2.546785e-27</td>
          <td>1.156468e-28</td>
          <td>6.548041e-26</td>
        </tr>
        <tr>
          <th>2</th>
          <td>51.13809</td>
          <td>7.151090</td>
          <td>1.138131</td>
          <td>0.878633</td>
          <td>4.024028e-10</td>
          <td>-5.398455e-11</td>
          <td>-8.745127e-10</td>
          <td>-9.774598e-12</td>
          <td>-1.394169e-09</td>
          <td>1.480870e-08</td>
          <td>1.619280e-19</td>
          <td>2.914332e-21</td>
          <td>7.647724e-19</td>
          <td>9.554276e-23</td>
          <td>1.943708e-18</td>
          <td>2.192975e-16</td>
          <td>2.074375e-19</td>
          <td>7.004936e-21</td>
          <td>1.088271e-18</td>
          <td>7.153699e-22</td>
          <td>2.013392e-18</td>
          <td>2.587528e-16</td>
          <td>6.653400e-25</td>
          <td>1.197459e-26</td>
          <td>1.736969e-27</td>
          <td>3.925721e-28</td>
          <td>3.225792e-27</td>
          <td>3.639476e-25</td>
          <td>8.523324e-25</td>
          <td>2.878232e-26</td>
          <td>2.471707e-27</td>
          <td>2.939357e-27</td>
          <td>3.341439e-27</td>
          <td>4.294281e-25</td>
        </tr>
        <tr>
          <th>3</th>
          <td>53.64215</td>
          <td>7.324080</td>
          <td>1.165664</td>
          <td>0.857880</td>
          <td>3.396294e-10</td>
          <td>-4.563913e-10</td>
          <td>3.302614e-09</td>
          <td>-1.937277e-12</td>
          <td>1.743117e-08</td>
          <td>1.145287e-08</td>
          <td>1.153482e-19</td>
          <td>2.082930e-19</td>
          <td>1.090726e-17</td>
          <td>3.753041e-24</td>
          <td>3.038457e-16</td>
          <td>1.311683e-16</td>
          <td>3.227857e-19</td>
          <td>2.152980e-19</td>
          <td>1.199553e-17</td>
          <td>7.191230e-22</td>
          <td>3.058590e-16</td>
          <td>3.899211e-16</td>
          <td>4.739498e-25</td>
          <td>8.558474e-25</td>
          <td>2.477282e-26</td>
          <td>1.542073e-29</td>
          <td>5.042644e-25</td>
          <td>2.176878e-25</td>
          <td>1.326282e-24</td>
          <td>8.846298e-25</td>
          <td>2.724453e-26</td>
          <td>2.954778e-27</td>
          <td>5.076058e-25</td>
          <td>6.471158e-25</td>
        </tr>
        <tr>
          <th>4</th>
          <td>53.64215</td>
          <td>7.324080</td>
          <td>1.165664</td>
          <td>0.857880</td>
          <td>-6.006892e-11</td>
          <td>-2.575128e-10</td>
          <td>-1.834748e-10</td>
          <td>-4.978899e-12</td>
          <td>9.513005e-09</td>
          <td>-2.254505e-09</td>
          <td>3.608275e-21</td>
          <td>6.631284e-20</td>
          <td>3.366300e-20</td>
          <td>2.478944e-23</td>
          <td>9.049726e-17</td>
          <td>5.082791e-18</td>
          <td>3.263940e-19</td>
          <td>2.816108e-19</td>
          <td>1.202919e-17</td>
          <td>7.439124e-22</td>
          <td>3.963563e-16</td>
          <td>3.950039e-16</td>
          <td>1.482591e-26</td>
          <td>2.724704e-25</td>
          <td>7.645618e-29</td>
          <td>1.018564e-28</td>
          <td>1.501899e-25</td>
          <td>8.435437e-27</td>
          <td>1.341108e-24</td>
          <td>1.157100e-24</td>
          <td>2.732098e-26</td>
          <td>3.056634e-27</td>
          <td>6.577957e-25</td>
          <td>6.555512e-25</td>
        </tr>
        <tr>
          <th>5</th>
          <td>59.58843</td>
          <td>7.719354</td>
          <td>1.228573</td>
          <td>0.813952</td>
          <td>4.042192e-10</td>
          <td>6.548266e-10</td>
          <td>5.770587e-10</td>
          <td>1.697122e-12</td>
          <td>-2.767511e-08</td>
          <td>1.639054e-08</td>
          <td>1.633932e-19</td>
          <td>4.287978e-19</td>
          <td>3.329967e-19</td>
          <td>2.880222e-24</td>
          <td>7.659116e-16</td>
          <td>2.686497e-16</td>
          <td>4.897872e-19</td>
          <td>7.104086e-19</td>
          <td>1.236219e-17</td>
          <td>7.467926e-22</td>
          <td>1.162268e-15</td>
          <td>6.636535e-16</td>
          <td>6.713602e-25</td>
          <td>1.761872e-24</td>
          <td>7.563098e-28</td>
          <td>1.183444e-29</td>
          <td>1.271112e-24</td>
          <td>4.458529e-25</td>
          <td>2.012468e-24</td>
          <td>2.918972e-24</td>
          <td>2.807729e-26</td>
          <td>3.068468e-27</td>
          <td>1.928908e-24</td>
          <td>1.101404e-24</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 66-68

.. code-block:: Python

    modal_props.loc[[1, 47, 48, 60], "eigenFrequency"]








.. GENERATED FROM PYTHON SOURCE LINES 69-72

You can compare this with Code-Aster, which uses DKT shell elements.
See ~
`Model C: Modal analysis of a cooling tower <https://biba1632.gitlab.io/code-aster-manuals/docs/validation/v2.08.011.html#model-c-modal-analysis-of-a-cooling-tower>`_

.. GENERATED FROM PYTHON SOURCE LINES 74-78

Gmsh model
----------
You can find modeling instructions at:
`Creating quadrilateral surface meshes with gmsh <https://bbanerjee.github.io/ParSim/fem/meshing/gmsh/quadrlateral-meshing-with-gmsh/>`_

.. GENERATED FROM PYTHON SOURCE LINES 78-84

.. code-block:: Python


    import json
    import math

    import gmsh








.. GENERATED FROM PYTHON SOURCE LINES 85-86

Initialize gmsh

.. GENERATED FROM PYTHON SOURCE LINES 86-90

.. code-block:: Python

    gmsh.initialize()

    gmsh.model.add("forma11c_gmsh")








.. GENERATED FROM PYTHON SOURCE LINES 91-93

``forma11c_profile.json`` can be downloaded from
`here <https://biba1632.gitlab.io/code-aster-manuals/docs/validation/v2.08.011.html#geometry-and-mesh>`_

.. GENERATED FROM PYTHON SOURCE LINES 93-98

.. code-block:: Python


    # Read the profile coordinates
    with open("utils/forma11c_profile.json") as file_id:
        coords = json.load(file_id)








.. GENERATED FROM PYTHON SOURCE LINES 99-100

Set a default element size

.. GENERATED FROM PYTHON SOURCE LINES 100-108

.. code-block:: Python

    el_size = 1.0

    # Add profile points
    v_profile = []
    for coord in coords:
        v = gmsh.model.occ.addPoint(coord[0], coord[1], coord[2], el_size)
        v_profile.append(v)








.. GENERATED FROM PYTHON SOURCE LINES 109-110

Add spline going through profile points

.. GENERATED FROM PYTHON SOURCE LINES 110-121

.. code-block:: Python

    l1 = gmsh.model.occ.addBSpline(v_profile)
    # Create copies and rotate
    l2 = gmsh.model.occ.copy([(1, l1)])
    l3 = gmsh.model.occ.copy([(1, l1)])
    l4 = gmsh.model.occ.copy([(1, l1)])

    # Rotate the copy
    gmsh.model.occ.rotate(l2, 0, 0, 0, 0, 0, 1, math.pi / 2)
    gmsh.model.occ.rotate(l3, 0, 0, 0, 0, 0, 1, math.pi)
    gmsh.model.occ.rotate(l4, 0, 0, 0, 0, 0, 1, 3 * math.pi / 2)








.. GENERATED FROM PYTHON SOURCE LINES 122-123

Sweep the lines

.. GENERATED FROM PYTHON SOURCE LINES 123-128

.. code-block:: Python

    surf1 = gmsh.model.occ.revolve([(1, l1)], 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf2 = gmsh.model.occ.revolve(l2, 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf3 = gmsh.model.occ.revolve(l3, 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf4 = gmsh.model.occ.revolve(l4, 0, 0, 0, 0, 0, 1, math.pi / 2)








.. GENERATED FROM PYTHON SOURCE LINES 129-130

Join the surfaces

.. GENERATED FROM PYTHON SOURCE LINES 130-134

.. code-block:: Python

    surf5 = gmsh.model.occ.fragment(surf1, surf2)
    surf6 = gmsh.model.occ.fragment(surf3, surf4)
    surf7 = gmsh.model.occ.fragment(surf5[0], surf6[0])








.. GENERATED FROM PYTHON SOURCE LINES 135-138

.. code-block:: Python

    gmsh.model.occ.remove_all_duplicates()
    gmsh.model.occ.synchronize()








.. GENERATED FROM PYTHON SOURCE LINES 139-143

.. code-block:: Python

    num_nodes_circ = 15
    for curve in gmsh.model.occ.getEntities(1):
        gmsh.model.mesh.setTransfiniteCurve(curve[1], num_nodes_circ)








.. GENERATED FROM PYTHON SOURCE LINES 144-149

.. code-block:: Python

    num_nodes_vert = 32
    vertical_curves = [7, 10, 13, 17]
    for curve in vertical_curves:
        gmsh.model.mesh.setTransfiniteCurve(curve, num_nodes_vert)








.. GENERATED FROM PYTHON SOURCE LINES 150-153

.. code-block:: Python

    for surf in gmsh.model.occ.getEntities(2):
        gmsh.model.mesh.setTransfiniteSurface(surf[1])








.. GENERATED FROM PYTHON SOURCE LINES 154-159

.. code-block:: Python

    gmsh.option.setNumber("Mesh.RecombineAll", 1)
    gmsh.option.setNumber("Mesh.RecombinationAlgorithm", 1)
    gmsh.option.setNumber("Mesh.Recombine3DLevel", 2)
    gmsh.option.setNumber("Mesh.ElementOrder", 1)








.. GENERATED FROM PYTHON SOURCE LINES 160-163

Important:
Note that we use names to distinguish groups, so please do not overlook this!
We use the "Boundary" group to include 4 lines

.. GENERATED FROM PYTHON SOURCE LINES 163-165

.. code-block:: Python

    gmsh.model.addPhysicalGroup(dim=1, tags=[6, 9, 12, 15], tag=1, name="Boundary")








.. GENERATED FROM PYTHON SOURCE LINES 166-167

Generate mesh

.. GENERATED FROM PYTHON SOURCE LINES 167-171

.. code-block:: Python

    gmsh.model.mesh.generate(dim=2)
    gmsh.option.setNumber("Mesh.SaveAll", 1)
    gmsh.write("utils/forma11c.msh")
    # gmsh.fltk.run()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 4.364 seconds)


.. _sphx_glr_download_auto_examples_examples_postprocessing_ex-forma11c.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-forma11c.ipynb <ex-forma11c.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-forma11c.py <ex-forma11c.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-forma11c.zip <ex-forma11c.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
