
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\examples\preprocessing\ex-read-gmsh-4.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_examples_preprocessing_ex-read-gmsh-4.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_examples_preprocessing_ex-read-gmsh-4.py:


Gmsh2OPS: Linear shell arch model
==================================

.. GENERATED FROM PYTHON SOURCE LINES 7-14

.. code-block:: Python

    import openseespy.opensees as ops

    import opstool as opst

    ops.wipe()
    ops.model("basic", "-ndm", 3, "-ndf", 6)








.. GENERATED FROM PYTHON SOURCE LINES 15-17

Read mesh file
------------------

.. GENERATED FROM PYTHON SOURCE LINES 17-23

.. code-block:: Python


    GmshModel = opst.pre.Gmsh2OPS(ndm=3, ndf=6)
    GmshModel.read_gmsh_file("utils/I_beam.msh")

    GmshModel.get_physical_groups()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Info:: 3 Physical Names.
    Info:: 1076 Nodes; MaxNodeTag 1076; MinNodeTag 1.
    Info:: 1357 Elements; MaxEleTag 1357; MinEleTag 1.
    Info:: Geometry Information >>>
    38 Entities: 17 Point; 16 Curves; 5 Surfaces; 0 Volumes.

    Info:: Physical Groups Information >>>
    3 Physical Groups.
    Physical Group names: ['start_section', 'end_section', 'surfaces']

    Info:: Mesh Information >>>
    1076 Nodes; MaxNodeTag 1076; MinNodeTag 1.
    1340 Elements; MaxEleTag 1357; MinEleTag 18.





.. GENERATED FROM PYTHON SOURCE LINES 24-26

Create nodes
-------------

.. GENERATED FROM PYTHON SOURCE LINES 26-28

.. code-block:: Python

    node_tags = GmshModel.create_node_cmds()








.. GENERATED FROM PYTHON SOURCE LINES 29-30

Get boundary points by physics group:

.. GENERATED FROM PYTHON SOURCE LINES 30-36

.. code-block:: Python

    fixed_tags = GmshModel.get_boundary_dim_tags(physical_group_names=["start_section", "end_section"], include_self=True)
    fixed_node_tags = GmshModel.get_node_tags(dim_entity_tags=fixed_tags)

    for node_tag in fixed_node_tags:
        ops.fix(node_tag, *[1, 1, 1, 1, 1, 1])








.. GENERATED FROM PYTHON SOURCE LINES 37-40

Create shell elements
----------------------
We use `ASDShellQ4 <https://opensees.github.io/OpenSeesDocumentation/user/manual/model/elements/ASDShellQ4.html>`_ to create the shell elements:

.. GENERATED FROM PYTHON SOURCE LINES 40-56

.. code-block:: Python


    # material parameters
    thick = 1e-2  # 1 cm
    E = 210e6  # 210 GPa
    nu = 0.3
    rho = 7.85  #  ton/m3

    # create a fiber shell section with 5 layers of material 1
    # each layer has a thickness = thick / 5
    matTag, secTag = 1, 11
    # rho will added to the material, and then to the element automatically
    ops.nDMaterial("ElasticIsotropic", matTag, E, nu, rho)
    n_layers = 5
    args = [matTag, thick / n_layers] * n_layers
    ops.section("LayeredShell", secTag, n_layers, *args)








.. GENERATED FROM PYTHON SOURCE LINES 57-68

.. code-block:: Python


    # element ASDShellT3 $eleTag $n1 $n2 $n3 $secTag
    shell_ele_tags = GmshModel.create_element_cmds(
        ops_ele_type="ASDShellQ4",
        ops_ele_args=[secTag],
        physical_group_names=["surfaces"],
    )

    # remove void nodes maybe generated by gmsh
    opst.pre.remove_void_nodes()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using ASDShellQ4 - Developed by: Massimo Petracca, Guido Camata, ASDEA Software Technology
    Info:: Free nodes with tags [9, 10, 12, 15, 17] have been removed!




.. GENERATED FROM PYTHON SOURCE LINES 69-71

Visualization model geometry
-----------------------------

.. GENERATED FROM PYTHON SOURCE LINES 71-76

.. code-block:: Python


    opst.vis.pyvista.set_plot_props()
    fig = opst.vis.pyvista.plot_model()
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/preprocessing/images/sphx_glr_ex-read-gmsh-4_001.png
        :alt: ex read gmsh 4
        :srcset: /auto_examples/examples/preprocessing/images/sphx_glr_ex-read-gmsh-4_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\preprocessing\images\sphx_glr_ex-read-gmsh-4_001.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 77-80

Model Mass and Gravity Loads. Because we have defined the material density,
the mass matrix will be automatically computed by OpenSees when we create the elements.
We can check the nodal masses by:

.. GENERATED FROM PYTHON SOURCE LINES 80-82

.. code-block:: Python

    node_masses = opst.pre.get_node_mass()








.. GENERATED FROM PYTHON SOURCE LINES 83-84

Likewise, we can create gravity loads using the utility function, it will automatically extract the nodal masses and create the load pattern for gravity loads.

.. GENERATED FROM PYTHON SOURCE LINES 84-89

.. code-block:: Python

    ops.timeSeries("Linear", 1)
    ops.pattern("Plain", 1, 1)
    opst.pre.create_gravity_load(direction="z", factor=-9.81)









.. GENERATED FROM PYTHON SOURCE LINES 90-92

Eigen Visulaization
---------------------

.. GENERATED FROM PYTHON SOURCE LINES 92-96

.. code-block:: Python


    fig = opst.vis.pyvista.plot_eigen(mode_tags=[1, 8], subplots=True)
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/preprocessing/images/sphx_glr_ex-read-gmsh-4_002.png
        :alt: ex read gmsh 4
        :srcset: /auto_examples/examples/preprocessing/images/sphx_glr_ex-read-gmsh-4_002.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\preprocessing\images\sphx_glr_ex-read-gmsh-4_002.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Using DomainModalProperties - Developed by: Massimo Petracca, Guido Camata, ASDEA Software Technology
    OPSTOOL ::  Eigen data has been saved to G:\opstool\docs\.opstool.output/EigenData-Auto.nc!




.. GENERATED FROM PYTHON SOURCE LINES 98-102

Gmsh model
-----------------
You can find the Gmsh modeling instructions for this model here:
`Generating a shell model with the Gmsh Python API <https://bleyerj.github.io/comet-fenicsx/tours/shells/I_beam_gmsh/I_beam_gmsh.html#>`_.

.. GENERATED FROM PYTHON SOURCE LINES 102-117

.. code-block:: Python


    import gmsh
    import numpy as np

    filename = "I_beam"
    # I-beam profile
    wb = 0.2  # bottom flange width
    wt = 0.3  # top flange width
    h = 0.5  # web height
    # Arch geometry
    theta = np.pi / 6  # arch opening half-angle
    L = 10.0  # chord length
    R = L / 2 / np.sin(theta)  # arch radius
    f = R - L / 2 / np.tan(theta)  # arch rise








.. GENERATED FROM PYTHON SOURCE LINES 118-122

.. code-block:: Python

    gmsh.initialize()
    gmsh.model.add(filename)
    geom = gmsh.model.geo








.. GENERATED FROM PYTHON SOURCE LINES 123-145

.. code-block:: Python

    lcar = 0.1  # characteristic mesh size density (will not be used)
    bottom_points = [
        geom.addPoint(0, -wb / 2, -h / 2, lcar),
        geom.addPoint(0, 0, -h / 2, lcar),
        geom.addPoint(0, wb / 2, -h / 2, lcar),
    ]
    top_points = [
        geom.addPoint(0, -wt / 2, h / 2, lcar),
        geom.addPoint(0, 0, h / 2, lcar),
        geom.addPoint(0, wt / 2, h / 2, lcar),
    ]
    bottom_flange = [
        geom.addLine(bottom_points[0], bottom_points[1]),
        geom.addLine(bottom_points[1], bottom_points[2]),
    ]
    web = [geom.addLine(bottom_points[1], top_points[1])]
    top_flange = [
        geom.addLine(top_points[0], top_points[1]),
        geom.addLine(top_points[1], top_points[2]),
    ]
    start_section = bottom_flange + web + top_flange








.. GENERATED FROM PYTHON SOURCE LINES 146-169

.. code-block:: Python

    end_bottom_flange = []
    end_top_flange = []
    end_web = []
    surfaces = []
    for ini, end in zip([bottom_flange, web, top_flange], [end_bottom_flange, end_web, end_top_flange]):
        for l in ini:
            outDimTags = geom.revolve(
                [(1, l)],
                L / 2,
                0,
                -(R - f),
                0,
                1,
                0,
                2 * theta,
                numElements=[50],
                heights=[1.0],
            )
            end.append(outDimTags[0][1])
            surfaces.append(outDimTags[1][1])
            geom.synchronize()
    end_section = end_bottom_flange + end_web + end_top_flange








.. GENERATED FROM PYTHON SOURCE LINES 170-171

Add a physical group. The name of the physical group is important for the subsequent conversion.

.. GENERATED FROM PYTHON SOURCE LINES 171-178

.. code-block:: Python

    gmsh.model.add_physical_group(dim=1, tags=start_section, tag=1, name="start_section")
    gmsh.model.add_physical_group(dim=1, tags=end_section, tag=2, name="end_section")

    plane_tags = gmsh.model.get_entities(dim=2)
    plane_tags = [tag[1] for tag in plane_tags]
    gmsh.model.add_physical_group(dim=2, tags=plane_tags, tag=3, name="surfaces")








.. GENERATED FROM PYTHON SOURCE LINES 179-182

for quad mesh
if does not work, try to use Recombine 2D in gmsh GUI
you can find options in https://gmsh.info/doc/texinfo/gmsh.html#Mesh-options

.. GENERATED FROM PYTHON SOURCE LINES 182-192

.. code-block:: Python

    gmsh.option.setNumber("Mesh.RecombineAll", 1)
    gmsh.option.setNumber("Mesh.RecombinationAlgorithm", 2)
    gmsh.option.setNumber("Mesh.Algorithm", 8)
    gmsh.option.setNumber("Mesh.ElementOrder", 1)
    gmsh.model.mesh.generate(dim=2)

    gmsh.option.setNumber("Mesh.SaveAll", 1)
    # gmsh.write(filename + ".msh")
    # gmsh.fltk.run()  # uncomment to visualize the geometry
    gmsh.finalize()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 2.059 seconds)


.. _sphx_glr_download_auto_examples_examples_preprocessing_ex-read-gmsh-4.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-read-gmsh-4.ipynb <ex-read-gmsh-4.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-read-gmsh-4.py <ex-read-gmsh-4.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-read-gmsh-4.zip <ex-read-gmsh-4.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
