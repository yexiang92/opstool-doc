
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\vis-guide\pyvista\ex-06-shell-resp-pyvista.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_vis-guide_pyvista_ex-06-shell-resp-pyvista.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_vis-guide_pyvista_ex-06-shell-resp-pyvista.py:


Shell Element Responses
=======================

.. GENERATED FROM PYTHON SOURCE LINES 7-12

.. code-block:: Python

    import openseespy.opensees as ops

    import opstool as opst
    import opstool.vis.pyvista as opsvis








.. GENERATED FROM PYTHON SOURCE LINES 13-15

Model and gravity load
------------------------

.. GENERATED FROM PYTHON SOURCE LINES 15-21

.. code-block:: Python

    opst.load_ops_examples("Shell3D")

    ops.timeSeries("Linear", 1)
    ops.pattern("Plain", 1, 1)
    _ = opst.pre.gen_grav_load(direction="Z", factor=-9810)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    The original Tcl file comes from http://www.dinochen.com/, and the Python version is converted by opstool.tcl2py().




.. GENERATED FROM PYTHON SOURCE LINES 22-26

.. code-block:: Python

    opsvis.set_plot_props(point_size=0, line_width=3)  # notebook=False for practical use
    fig = opsvis.plot_model(show_nodal_loads=True, show_ele_loads=True, show_outline=True)
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_001.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_001.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f891d60_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 27-29

Gravity analysis
-----------------

.. GENERATED FROM PYTHON SOURCE LINES 29-37

.. code-block:: Python

    ops.constraints("Transformation")
    ops.numberer("RCM")
    ops.system("BandGeneral")
    ops.test("NormDispIncr", 1.0e-8, 6, 2)
    ops.algorithm("Linear")
    ops.integrator("LoadControl", 0.1)
    ops.analysis("Static")








.. GENERATED FROM PYTHON SOURCE LINES 38-39

Save the responses

.. GENERATED FROM PYTHON SOURCE LINES 39-49

.. code-block:: Python

    ODB = opst.post.CreateODB(
        odb_tag=1,
        project_gauss_to_nodes="copy",  # project gauss point responses to nodes, optional ["copy", "average", "extrapolate"]
    )
    for _ in range(10):
        ops.analyze(1)
        ODB.fetch_response_step()
    ODB.save_response()






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  All responses data with _odb_tag = 1 saved in G:\opstool\docs\.opstool.output/RespStepData-1.zarr!




.. GENERATED FROM PYTHON SOURCE LINES 50-53

Visualize the results
------------------------
Nodal responses, ``project_gauss_to_nodes`` needs to be set to "copy", "average", or "extrapolate" when creating the ODB

.. GENERATED FROM PYTHON SOURCE LINES 53-65

.. code-block:: Python

    opsvis.set_plot_props(cmap="coolwarm_r", show_mesh_edges=True)

    fig = opsvis.plot_unstruct_responses(
        odb_tag=1,
        slides=False,
        step="absMax",
        ele_type="Shell",
        resp_type="sectionForcesAtNodes",  # nodal response, "AtNodes"
        resp_dof="FXX",
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_002.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_002.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_002.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f5843b0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 66-67

Display the responses at each element, all gauss points will be averaged to the element level.

.. GENERATED FROM PYTHON SOURCE LINES 67-76

.. code-block:: Python

    fig = opsvis.plot_unstruct_responses(
        odb_tag=1,
        slides=True,
        ele_type="Shell",
        resp_type="sectionForces",  # element response, "AtGaussPoints", will be averaged to each element
        resp_dof="FXX",
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_003.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_003.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_003.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f7979e0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 77-79

Fiber point stress can be plotted as well, but it requires a ``shell_fiber_loc`` to be assigned.
sphinx_gallery_thumbnail_number = 5

.. GENERATED FROM PYTHON SOURCE LINES 79-90

.. code-block:: Python

    fig = opsvis.plot_unstruct_responses(
        odb_tag=1,
        slides=False,
        step="absMax",
        ele_type="Shell",
        resp_type="StressesAtNodes",  # nodal stress response, "AtNodes"
        resp_dof="sigma11",  # sigma11, sigma22, sigma12, sigma13, sigma23
        shell_fiber_loc="top",  # shell_fiber_loc can be "top", "bottom", or "mid" for shell elements, also int
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_004.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_004.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_004.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f587cb0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 91-96

Interacting with Pyvista
--------------------------
Since version 1.0.18, opstool provides a function ``get_unstruct_responses_dataset`` that returns a
pyvista `UnstructuredGrid <https://docs.pyvista.org/api/core/_autosummary/pyvista.unstructuredgrid#pyvista.UnstructuredGrid>`_
so that you can take advantage of all the functionality on it.

.. GENERATED FROM PYTHON SOURCE LINES 96-107

.. code-block:: Python

    import pyvista as pv

    grid = opsvis.get_unstruct_responses_dataset(
        odb_tag=1,
        step="absMax",
        ele_type="Shell",
        resp_type="StressesAtNodes",  # nodal stress response, "AtNodes"
        resp_dof="sigma11",  # sigma11, sigma22, sigma12, sigma13, sigma23
        shell_fiber_loc="top",  # shell_fiber_loc can be "top", "bottom", or "mid" for shell elements, also int
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...




.. GENERATED FROM PYTHON SOURCE LINES 108-112

.. code-block:: Python

    print(grid)
    print("--" * 20)
    print(grid.active_scalars_name)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    UnstructuredGrid (0x1da8f14f3a0)
      N Cells:    100
      N Points:   121
      X Bounds:   0.000e+00, 6.000e+03
      Y Bounds:   0.000e+00, 0.000e+00
      Z Bounds:   0.000e+00, 3.000e+03
      N Arrays:   1
    ----------------------------------------
    StressesAtNodes




.. GENERATED FROM PYTHON SOURCE LINES 113-115

.. code-block:: Python

    grid.plot(show_edges=True, cmap="viridis_r", show_scalar_bar=True)








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_005.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_005.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_005.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 116-118

Plot Over Line
~~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 118-120

.. code-block:: Python

    print(grid.bounds)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    BoundsTuple(x_min =    0.0,
                x_max = 6000.0,
                y_min =    0.0,
                y_max =    0.0,
                z_min =    0.0,
                z_max = 3000.0)




.. GENERATED FROM PYTHON SOURCE LINES 121-132

.. code-block:: Python

    a = [0, 0, 0]
    b = [6000, 0, 3000]  # A line from (0, 0, 0) to (0, 0, 1)

    # Preview how this line intersects this mesh
    line = pv.Line(a, b)

    p = pv.Plotter()
    p.add_mesh(grid, style="wireframe", color="w")
    p.add_mesh(line, color="b")
    p.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_006.png
        :alt: ex 06 shell resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_006.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-06-shell-resp-pyvista_006.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 133-135

.. code-block:: Python

    grid.plot_over_line(a, b)




.. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_007.png
   :alt: StressesAtNodes Profile
   :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-06-shell-resp-pyvista_007.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 136-137

More details can be found in the `PyVista Examples <https://docs.pyvista.org/examples/>`_.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 4.234 seconds)


.. _sphx_glr_download_auto_examples_vis-guide_pyvista_ex-06-shell-resp-pyvista.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-06-shell-resp-pyvista.ipynb <ex-06-shell-resp-pyvista.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-06-shell-resp-pyvista.py <ex-06-shell-resp-pyvista.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-06-shell-resp-pyvista.zip <ex-06-shell-resp-pyvista.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
