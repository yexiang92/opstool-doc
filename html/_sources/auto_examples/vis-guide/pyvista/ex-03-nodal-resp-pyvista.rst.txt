
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\vis-guide\pyvista\ex-03-nodal-resp-pyvista.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_vis-guide_pyvista_ex-03-nodal-resp-pyvista.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_vis-guide_pyvista_ex-03-nodal-resp-pyvista.py:


Nodal Responses Visualization
=============================

.. GENERATED FROM PYTHON SOURCE LINES 7-12

.. code-block:: Python

    import openseespy.opensees as ops

    import opstool as opst
    import opstool.vis.pyvista as opsvis








.. GENERATED FROM PYTHON SOURCE LINES 13-14

Here, we use a built-in example from ``opstool``, which is an example of a deck arch bridge model primarily composed of frame elements and shell elements.

.. GENERATED FROM PYTHON SOURCE LINES 16-19

.. code-block:: Python

    opst.load_ops_examples("ArchBridge2")
    # or your model code here








.. GENERATED FROM PYTHON SOURCE LINES 20-21

We use the :func:`opstool.vis.pyvista.set_plot_props` function to predefine some common visualization properties, which will affect all subsequent visualizations of models, eigenvalues, and responses.

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Model Geometry
---------------

.. GENERATED FROM PYTHON SOURCE LINES 25-30

.. code-block:: Python

    opsvis.set_plot_props(point_size=0, line_width=3)

    fig = opsvis.plot_model(show_outline=True)
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_001.png
        :alt: ex 03 nodal resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-03-nodal-resp-pyvista_001.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da907087a0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 31-34

Gravity Analysis
----------------
Apply the gravity load according to the mass in the model:

.. GENERATED FROM PYTHON SOURCE LINES 34-38

.. code-block:: Python

    ops.timeSeries("Linear", 1)
    ops.pattern("Plain", 1, 1)
    _ = opst.pre.gen_grav_load(factor=-9810)








.. GENERATED FROM PYTHON SOURCE LINES 39-40

Analysis Parameters:

.. GENERATED FROM PYTHON SOURCE LINES 40-55

.. code-block:: Python

    ops.system("BandGeneral")
    # Create the constraint handler, the transformation method
    ops.constraints("Transformation")
    # Create the DOF numberer, the reverse Cuthill-McKee algorithm
    ops.numberer("RCM")
    # Create the convergence test, the norm of the residual with a tolerance of
    # 1e-12 and a max number of iterations of 10
    ops.test("NormDispIncr", 1.0e-12, 10, 3)
    # Create the solution algorithm, a Newton-Raphson algorithm
    ops.algorithm("Newton")
    # Create the integration scheme, the LoadControl scheme using steps of 0.1
    ops.integrator("LoadControl", 0.1)
    # Create the analysis object
    ops.analysis("Static")








.. GENERATED FROM PYTHON SOURCE LINES 56-57

Analysis and Saving Results

.. GENERATED FROM PYTHON SOURCE LINES 57-64

.. code-block:: Python


    ODB = opst.post.CreateODB(odb_tag=1)
    for i in range(10):
        ops.analyze(1)
        ODB.fetch_response_step()
    ODB.save_response()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  All responses data with _odb_tag = 1 saved in G:\opstool\docs\.opstool.output/RespStepData-1.zarr!




.. GENERATED FROM PYTHON SOURCE LINES 65-69

Nodal Responses Visualization
-----------------------------
via Slides
~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 69-81

.. code-block:: Python

    opsvis.set_plot_props(scalar_bar_kargs={"title_font_size": 12, "label_font_size": 12})
    fig = opsvis.plot_nodal_responses(
        odb_tag=1,
        slides=True,
        resp_type="disp",
        resp_dof=["UX", "UY", "UZ"],
        unit_symbol="mm",
        show_outline=True,
        defo_scale="auto",
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_002.png
        :alt: ex 03 nodal resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_002.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-03-nodal-resp-pyvista_002.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f8baa80_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 83-85

Change the unit dispaly
~~~~~~~~~~~~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 85-98

.. code-block:: Python

    opsvis.set_plot_colors(cmap="Spectral_r")
    fig = opsvis.plot_nodal_responses(
        odb_tag=1,
        slides=True,
        step=9,
        resp_type="disp",
        resp_dof=["UX", "UY", "UZ"],
        unit_symbol="m",
        unit_factor=1e-3,
        defo_scale=100,  # you can adjust the deformation scale factor here
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_003.png
        :alt: ex 03 nodal resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_003.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-03-nodal-resp-pyvista_003.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Widget(value='<iframe src="http://localhost:61479/index.html?ui=P_0x1da8f8da840_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 99-101

Animation
~~~~~~~~~~~~~

.. GENERATED FROM PYTHON SOURCE LINES 101-114

.. code-block:: Python

    fig = opsvis.plot_nodal_responses_animation(
        odb_tag=1,
        framerate=2,
        defo_scale=100,
        savefig="images/NodalRespAnimation.gif",
        resp_type="disp",
        resp_dof=["UX", "UY", "UZ"],
        unit_symbol="m",
        unit_factor=1e-3,
    )
    fig.close()






.. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_004.gif
   :alt: ex 03 nodal resp pyvista
   :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_004.gif
   :class: sphx-glr-single-img




.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...
    Animation has been saved to images/NodalRespAnimation.gif!




.. GENERATED FROM PYTHON SOURCE LINES 115-120

Interacting with Pyvista
-----------------------------
Since version 1.0.18, opstool provides a function ``get_nodal_responses_dataset`` that returns a pyvista
`UnstructuredGrid <https://docs.pyvista.org/api/core/_autosummary/pyvista.unstructuredgrid#pyvista.UnstructuredGrid>`_
so that you can take advantage of all the functionality on it.

.. GENERATED FROM PYTHON SOURCE LINES 120-130

.. code-block:: Python



    grid = opsvis.get_nodal_responses_dataset(
        odb_tag=1,
        step="absMax",
        resp_type="disp",
        resp_dof=["UX", "UY", "UZ"],
        defo_scale=100,
    )





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.zarr ...




.. GENERATED FROM PYTHON SOURCE LINES 131-132

The name of the scalar data to be activated will be the passed in ``resp_type``:

.. GENERATED FROM PYTHON SOURCE LINES 132-135

.. code-block:: Python

    print(grid)
    print(grid.active_scalars_name)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    UnstructuredGrid (0x1da9f392ec0)
      N Cells:    439
      N Points:   241
      X Bounds:   -8.820e+02, 1.259e+05
      Y Bounds:   -7.853e+01, 2.408e+04
      Z Bounds:   -8.045e+03, 2.775e+04
      N Arrays:   1
    disp




.. GENERATED FROM PYTHON SOURCE LINES 136-137

You can call the plot method directly:

.. GENERATED FROM PYTHON SOURCE LINES 137-139

.. code-block:: Python

    grid.plot()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_005.png
        :alt: ex 03 nodal resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_005.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-03-nodal-resp-pyvista_005.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 140-147

You can also use the filters provided by pyvista:
`DataSetFilters <https://docs.pyvista.org/api/core/_autosummary/pyvista.datasetfilters#pyvista.DataSetFilters>`_

For example, using some common filters:
`Using Common Filters <https://docs.pyvista.org/examples/01-filter/using_filters>`_

Apply a threshold over a data range

.. GENERATED FROM PYTHON SOURCE LINES 147-155

.. code-block:: Python

    import pyvista as pv

    threshed = grid.threshold([80, 120])

    p = pv.Plotter()
    p.add_mesh(threshed)
    p.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_006.png
        :alt: ex 03 nodal resp pyvista
        :srcset: /auto_examples/vis-guide/pyvista/images/sphx_glr_ex-03-nodal-resp-pyvista_006.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\vis-guide\pyvista\images\sphx_glr_ex-03-nodal-resp-pyvista_006.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 156-157

More details can be found in the `PyVista Examples <https://docs.pyvista.org/examples/>`_.


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 5.325 seconds)


.. _sphx_glr_download_auto_examples_vis-guide_pyvista_ex-03-nodal-resp-pyvista.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-03-nodal-resp-pyvista.ipynb <ex-03-nodal-resp-pyvista.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-03-nodal-resp-pyvista.py <ex-03-nodal-resp-pyvista.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-03-nodal-resp-pyvista.zip <ex-03-nodal-resp-pyvista.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
