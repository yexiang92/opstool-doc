
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\examples\postprocessing\ex-forma11c.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_examples_postprocessing_ex-forma11c.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_examples_postprocessing_ex-forma11c.py:


Modal analysis of a cooling tower
===================================

.. GENERATED FROM PYTHON SOURCE LINES 7-9

To OpenSeesPy Model
--------------------

.. GENERATED FROM PYTHON SOURCE LINES 9-13

.. code-block:: Python

    import openseespy.opensees as ops

    import opstool as opst








.. GENERATED FROM PYTHON SOURCE LINES 14-21

.. code-block:: Python

    ops.wipe()
    ops.model("basic", "-ndm", 3, "-ndf", 6)
    E, nu, rho = 2.76e10, 0.166, 2244.0  # Pa, kg/m3
    ops.nDMaterial("ElasticIsotropic", 1, E, nu, rho)
    secTag = 11
    ops.section("PlateFiber", secTag, 1, 0.305)








.. GENERATED FROM PYTHON SOURCE LINES 22-23

Read gmsh

.. GENERATED FROM PYTHON SOURCE LINES 23-26

.. code-block:: Python

    GMSH2OPS = opst.pre.Gmsh2OPS(ndm=3, ndf=6)
    GMSH2OPS.read_gmsh_file("utils/forma11c.msh")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Info:: 1 Physical Names.
    Info:: 1821 Nodes; MaxNodeTag 1821; MinNodeTag 1.
    Info:: 2009 Elements; MaxEleTag 2009; MinEleTag 1.
    Info:: Geometry Information >>>
    53 Entities: 37 Point; 12 Curves; 4 Surfaces; 0 Volumes.

    Info:: Physical Groups Information >>>
    1 Physical Groups.
    Physical Group names: ['Boundary']

    Info:: Mesh Information >>>
    1821 Nodes; MaxNodeTag 1821; MinNodeTag 1.
    1972 Elements; MaxEleTag 2009; MinEleTag 1.





.. GENERATED FROM PYTHON SOURCE LINES 27-28

Create OpenSeesPy node commands based on all nodes defined in the GMSH file

.. GENERATED FROM PYTHON SOURCE LINES 28-30

.. code-block:: Python

    node_tags = GMSH2OPS.create_node_cmds()








.. GENERATED FROM PYTHON SOURCE LINES 31-34

.. code-block:: Python

    dim_entity_tags = GMSH2OPS.get_dim_entity_tags()
    dim_entity_tags_2D = [item for item in dim_entity_tags if item[0] == 2]








.. GENERATED FROM PYTHON SOURCE LINES 35-36

Create OpenSeesPy element commands for specific entities

.. GENERATED FROM PYTHON SOURCE LINES 36-42

.. code-block:: Python

    ele_tags_n4 = GMSH2OPS.create_element_cmds(
        ops_ele_type="ASDShellQ4",  # OpenSeesPy element type
        ops_ele_args=[secTag],  # Additional arguments for the element (e.g., section tag)
        dim_entity_tags=dim_entity_tags_2D,
    )








.. GENERATED FROM PYTHON SOURCE LINES 43-44

Apply boundary conditions

.. GENERATED FROM PYTHON SOURCE LINES 44-49

.. code-block:: Python

    boundary_dim_tags = GMSH2OPS.get_boundary_dim_tags(physical_group_names="Boundary", include_self=True)
    print(boundary_dim_tags)
    fix_ntags = GMSH2OPS.create_fix_cmds(dim_entity_tags=boundary_dim_tags, dofs=[1] * 6)
    removed_node_tags = opst.pre.remove_void_nodes()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    [(0, 55), (0, 59), (0, 61), (0, 63), (1, 6), (1, 9), (1, 12), (1, 15)]
    Info:: Free nodes with tags [57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85] have been removed!




.. GENERATED FROM PYTHON SOURCE LINES 50-51

Visualize the model

.. GENERATED FROM PYTHON SOURCE LINES 51-53

.. code-block:: Python

    opst.vis.pyvista.plot_model(show_outline=True).show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_001.png
        :alt: ex forma11c
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-forma11c_001.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 54-55

Modal analysis

.. GENERATED FROM PYTHON SOURCE LINES 55-59

.. code-block:: Python

    opst.post.save_eigen_data(odb_tag="eigen", mode_tag=60)
    fig = opst.vis.pyvista.plot_eigen(mode_tags=12, odb_tag="eigen", subplots=True)
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_002.png
        :alt: ex forma11c
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-forma11c_002.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-forma11c_002.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Eigen data has been saved to G:\opstool\docs\.opstool.output/EigenData-eigen.nc!
    OPSTOOL ::  Loading eigen data from G:\opstool\docs\.opstool.output/EigenData-eigen.nc ...




.. GENERATED FROM PYTHON SOURCE LINES 60-61

Modal Properties

.. GENERATED FROM PYTHON SOURCE LINES 61-65

.. code-block:: Python

    modal_props, eigen_vectors = opst.post.get_eigen_data(odb_tag="eigen")
    modal_props = modal_props.to_pandas()
    modal_props.head()





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading eigen data from G:\opstool\docs\.opstool.output/EigenData-eigen.nc ...


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th>Properties</th>
          <th>eigenLambda</th>
          <th>eigenOmega</th>
          <th>eigenFrequency</th>
          <th>eigenPeriod</th>
          <th>partiFactorMX</th>
          <th>partiFactorMY</th>
          <th>partiFactorRMZ</th>
          <th>partiFactorMZ</th>
          <th>partiFactorRMX</th>
          <th>partiFactorRMY</th>
          <th>partiMassMX</th>
          <th>partiMassMY</th>
          <th>partiMassRMZ</th>
          <th>partiMassMZ</th>
          <th>partiMassRMX</th>
          <th>partiMassRMY</th>
          <th>partiMassesCumuMX</th>
          <th>partiMassesCumuMY</th>
          <th>partiMassesCumuRMZ</th>
          <th>partiMassesCumuMZ</th>
          <th>partiMassesCumuRMX</th>
          <th>partiMassesCumuRMY</th>
          <th>partiMassRatiosMX</th>
          <th>partiMassRatiosMY</th>
          <th>partiMassRatiosRMZ</th>
          <th>partiMassRatiosMZ</th>
          <th>partiMassRatiosRMX</th>
          <th>partiMassRatiosRMY</th>
          <th>partiMassRatiosCumuMX</th>
          <th>partiMassRatiosCumuMY</th>
          <th>partiMassRatiosCumuRMZ</th>
          <th>partiMassRatiosCumuMZ</th>
          <th>partiMassRatiosCumuRMX</th>
          <th>partiMassRatiosCumuRMY</th>
        </tr>
        <tr>
          <th>modeTags</th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>1</th>
          <td>51.13809</td>
          <td>7.151090</td>
          <td>1.138131</td>
          <td>0.878633</td>
          <td>2.133969e-10</td>
          <td>6.364177e-11</td>
          <td>-5.486945e-10</td>
          <td>2.494799e-11</td>
          <td>-2.666928e-10</td>
          <td>6.270539e-09</td>
          <td>4.553823e-20</td>
          <td>4.050275e-21</td>
          <td>3.010656e-19</td>
          <td>6.224021e-22</td>
          <td>7.112507e-20</td>
          <td>3.931966e-17</td>
          <td>4.553823e-20</td>
          <td>4.050275e-21</td>
          <td>3.010656e-19</td>
          <td>6.224021e-22</td>
          <td>7.112507e-20</td>
          <td>3.931966e-17</td>
          <td>1.871103e-25</td>
          <td>1.664202e-26</td>
          <td>6.837872e-28</td>
          <td>2.557365e-27</td>
          <td>1.180397e-28</td>
          <td>6.525518e-26</td>
          <td>1.871103e-25</td>
          <td>1.664202e-26</td>
          <td>6.837872e-28</td>
          <td>2.557365e-27</td>
          <td>1.180397e-28</td>
          <td>6.525518e-26</td>
        </tr>
        <tr>
          <th>2</th>
          <td>51.13809</td>
          <td>7.151090</td>
          <td>1.138131</td>
          <td>0.878633</td>
          <td>-4.038051e-10</td>
          <td>5.367005e-11</td>
          <td>8.538683e-10</td>
          <td>9.647547e-12</td>
          <td>1.339727e-09</td>
          <td>-1.490776e-08</td>
          <td>1.630586e-19</td>
          <td>2.880474e-21</td>
          <td>7.290911e-19</td>
          <td>9.307516e-23</td>
          <td>1.794869e-18</td>
          <td>2.222413e-16</td>
          <td>2.085968e-19</td>
          <td>6.930749e-21</td>
          <td>1.030157e-18</td>
          <td>7.154773e-22</td>
          <td>1.865994e-18</td>
          <td>2.615609e-16</td>
          <td>6.699853e-25</td>
          <td>1.183547e-26</td>
          <td>1.655929e-27</td>
          <td>3.824331e-28</td>
          <td>2.978778e-27</td>
          <td>3.688332e-25</td>
          <td>8.570956e-25</td>
          <td>2.847750e-26</td>
          <td>2.339716e-27</td>
          <td>2.939798e-27</td>
          <td>3.096818e-27</td>
          <td>4.340883e-25</td>
        </tr>
        <tr>
          <th>3</th>
          <td>53.64215</td>
          <td>7.324080</td>
          <td>1.165664</td>
          <td>0.857880</td>
          <td>3.368988e-10</td>
          <td>-4.552840e-10</td>
          <td>3.333600e-09</td>
          <td>-1.815867e-12</td>
          <td>1.744705e-08</td>
          <td>1.131496e-08</td>
          <td>1.135008e-19</td>
          <td>2.072836e-19</td>
          <td>1.111289e-17</td>
          <td>3.297373e-24</td>
          <td>3.043996e-16</td>
          <td>1.280283e-16</td>
          <td>3.220976e-19</td>
          <td>2.142143e-19</td>
          <td>1.214305e-17</td>
          <td>7.187746e-22</td>
          <td>3.062656e-16</td>
          <td>3.895892e-16</td>
          <td>4.663593e-25</td>
          <td>8.516997e-25</td>
          <td>2.523985e-26</td>
          <td>1.354845e-29</td>
          <td>5.051837e-25</td>
          <td>2.124766e-25</td>
          <td>1.323455e-24</td>
          <td>8.801772e-25</td>
          <td>2.757957e-26</td>
          <td>2.953346e-27</td>
          <td>5.082805e-25</td>
          <td>6.465650e-25</td>
        </tr>
        <tr>
          <th>4</th>
          <td>53.64215</td>
          <td>7.324080</td>
          <td>1.165664</td>
          <td>0.857880</td>
          <td>-6.047247e-11</td>
          <td>-2.568844e-10</td>
          <td>-1.481355e-10</td>
          <td>-4.953069e-12</td>
          <td>9.466048e-09</td>
          <td>-2.249435e-09</td>
          <td>3.656919e-21</td>
          <td>6.598958e-20</td>
          <td>2.194413e-20</td>
          <td>2.453289e-23</td>
          <td>8.960607e-17</td>
          <td>5.059960e-18</td>
          <td>3.257545e-19</td>
          <td>2.802039e-19</td>
          <td>1.216499e-17</td>
          <td>7.433075e-22</td>
          <td>3.958716e-16</td>
          <td>3.946491e-16</td>
          <td>1.502578e-26</td>
          <td>2.711421e-25</td>
          <td>4.984001e-29</td>
          <td>1.008023e-28</td>
          <td>1.487109e-25</td>
          <td>8.397545e-27</td>
          <td>1.338481e-24</td>
          <td>1.151319e-24</td>
          <td>2.762941e-26</td>
          <td>3.054149e-27</td>
          <td>6.569914e-25</td>
          <td>6.549625e-25</td>
        </tr>
        <tr>
          <th>5</th>
          <td>59.58843</td>
          <td>7.719354</td>
          <td>1.228573</td>
          <td>0.813952</td>
          <td>4.022156e-10</td>
          <td>6.531831e-10</td>
          <td>6.399340e-10</td>
          <td>1.772589e-12</td>
          <td>-2.760783e-08</td>
          <td>1.633968e-08</td>
          <td>1.617774e-19</td>
          <td>4.266481e-19</td>
          <td>4.095155e-19</td>
          <td>3.142072e-24</td>
          <td>7.621924e-16</td>
          <td>2.669850e-16</td>
          <td>4.875320e-19</td>
          <td>7.068520e-19</td>
          <td>1.257451e-17</td>
          <td>7.464496e-22</td>
          <td>1.158064e-15</td>
          <td>6.616342e-16</td>
          <td>6.647212e-25</td>
          <td>1.753039e-24</td>
          <td>9.301012e-28</td>
          <td>1.291034e-29</td>
          <td>1.264940e-24</td>
          <td>4.430902e-25</td>
          <td>2.003202e-24</td>
          <td>2.904358e-24</td>
          <td>2.855951e-26</td>
          <td>3.067059e-27</td>
          <td>1.921931e-24</td>
          <td>1.098053e-24</td>
        </tr>
      </tbody>
    </table>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 66-68

.. code-block:: Python

    modal_props.loc[[1, 47, 48, 60], "eigenFrequency"]








.. GENERATED FROM PYTHON SOURCE LINES 69-72

You can compare this with Code-Aster, which uses DKT shell elements.
See ~
`Model C: Modal analysis of a cooling tower <https://biba1632.gitlab.io/code-aster-manuals/docs/validation/v2.08.011.html#model-c-modal-analysis-of-a-cooling-tower>`_

.. GENERATED FROM PYTHON SOURCE LINES 74-78

Gmsh model
----------
You can find modeling instructions at:
`Creating quadrilateral surface meshes with gmsh <https://bbanerjee.github.io/ParSim/fem/meshing/gmsh/quadrlateral-meshing-with-gmsh/>`_

.. GENERATED FROM PYTHON SOURCE LINES 78-84

.. code-block:: Python


    import json
    import math

    import gmsh








.. GENERATED FROM PYTHON SOURCE LINES 85-86

Initialize gmsh

.. GENERATED FROM PYTHON SOURCE LINES 86-90

.. code-block:: Python

    gmsh.initialize()

    gmsh.model.add("forma11c_gmsh")








.. GENERATED FROM PYTHON SOURCE LINES 91-93

``forma11c_profile.json`` can be downloaded from
`here <https://biba1632.gitlab.io/code-aster-manuals/docs/validation/v2.08.011.html#geometry-and-mesh>`_

.. GENERATED FROM PYTHON SOURCE LINES 93-98

.. code-block:: Python


    # Read the profile coordinates
    with open("utils/forma11c_profile.json") as file_id:
        coords = json.load(file_id)








.. GENERATED FROM PYTHON SOURCE LINES 99-100

Set a default element size

.. GENERATED FROM PYTHON SOURCE LINES 100-108

.. code-block:: Python

    el_size = 1.0

    # Add profile points
    v_profile = []
    for coord in coords:
        v = gmsh.model.occ.addPoint(coord[0], coord[1], coord[2], el_size)
        v_profile.append(v)








.. GENERATED FROM PYTHON SOURCE LINES 109-110

Add spline going through profile points

.. GENERATED FROM PYTHON SOURCE LINES 110-121

.. code-block:: Python

    l1 = gmsh.model.occ.addBSpline(v_profile)
    # Create copies and rotate
    l2 = gmsh.model.occ.copy([(1, l1)])
    l3 = gmsh.model.occ.copy([(1, l1)])
    l4 = gmsh.model.occ.copy([(1, l1)])

    # Rotate the copy
    gmsh.model.occ.rotate(l2, 0, 0, 0, 0, 0, 1, math.pi / 2)
    gmsh.model.occ.rotate(l3, 0, 0, 0, 0, 0, 1, math.pi)
    gmsh.model.occ.rotate(l4, 0, 0, 0, 0, 0, 1, 3 * math.pi / 2)








.. GENERATED FROM PYTHON SOURCE LINES 122-123

Sweep the lines

.. GENERATED FROM PYTHON SOURCE LINES 123-128

.. code-block:: Python

    surf1 = gmsh.model.occ.revolve([(1, l1)], 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf2 = gmsh.model.occ.revolve(l2, 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf3 = gmsh.model.occ.revolve(l3, 0, 0, 0, 0, 0, 1, math.pi / 2)
    surf4 = gmsh.model.occ.revolve(l4, 0, 0, 0, 0, 0, 1, math.pi / 2)








.. GENERATED FROM PYTHON SOURCE LINES 129-130

Join the surfaces

.. GENERATED FROM PYTHON SOURCE LINES 130-134

.. code-block:: Python

    surf5 = gmsh.model.occ.fragment(surf1, surf2)
    surf6 = gmsh.model.occ.fragment(surf3, surf4)
    surf7 = gmsh.model.occ.fragment(surf5[0], surf6[0])








.. GENERATED FROM PYTHON SOURCE LINES 135-138

.. code-block:: Python

    gmsh.model.occ.remove_all_duplicates()
    gmsh.model.occ.synchronize()








.. GENERATED FROM PYTHON SOURCE LINES 139-143

.. code-block:: Python

    num_nodes_circ = 15
    for curve in gmsh.model.occ.getEntities(1):
        gmsh.model.mesh.setTransfiniteCurve(curve[1], num_nodes_circ)








.. GENERATED FROM PYTHON SOURCE LINES 144-149

.. code-block:: Python

    num_nodes_vert = 32
    vertical_curves = [7, 10, 13, 17]
    for curve in vertical_curves:
        gmsh.model.mesh.setTransfiniteCurve(curve, num_nodes_vert)








.. GENERATED FROM PYTHON SOURCE LINES 150-153

.. code-block:: Python

    for surf in gmsh.model.occ.getEntities(2):
        gmsh.model.mesh.setTransfiniteSurface(surf[1])








.. GENERATED FROM PYTHON SOURCE LINES 154-159

.. code-block:: Python

    gmsh.option.setNumber("Mesh.RecombineAll", 1)
    gmsh.option.setNumber("Mesh.RecombinationAlgorithm", 1)
    gmsh.option.setNumber("Mesh.Recombine3DLevel", 2)
    gmsh.option.setNumber("Mesh.ElementOrder", 1)








.. GENERATED FROM PYTHON SOURCE LINES 160-163

Important:
Note that we use names to distinguish groups, so please do not overlook this!
We use the "Boundary" group to include 4 lines

.. GENERATED FROM PYTHON SOURCE LINES 163-165

.. code-block:: Python

    gmsh.model.addPhysicalGroup(dim=1, tags=[6, 9, 12, 15], tag=1, name="Boundary")








.. GENERATED FROM PYTHON SOURCE LINES 166-167

Generate mesh

.. GENERATED FROM PYTHON SOURCE LINES 167-171

.. code-block:: Python

    gmsh.model.mesh.generate(dim=2)
    gmsh.option.setNumber("Mesh.SaveAll", 1)
    gmsh.write("utils/forma11c.msh")
    # gmsh.fltk.run()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.186 seconds)


.. _sphx_glr_download_auto_examples_examples_postprocessing_ex-forma11c.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-forma11c.ipynb <ex-forma11c.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-forma11c.py <ex-forma11c.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-forma11c.zip <ex-forma11c.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
