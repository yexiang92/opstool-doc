
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\examples\postprocessing\ex-ssi-Gu.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_examples_postprocessing_ex-ssi-Gu.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_examples_postprocessing_ex-ssi-Gu.py:


Soil-Structure Interaction
============================

This example originates from the GitHub repository maintained by Professor Quan Gu of Xiamen University.
`OpenSeesXMU <https://github.com/OpenSeesXMU/OpenSees-examples-Chinese/tree/master/1.5-SSI>`_

.. GENERATED FROM PYTHON SOURCE LINES 10-14

The TCL script has been translated into a Python script using
`opstool.pre.tcl2py <https://opstool.readthedocs.io/en/latest/src/api/_autosummary/opstool.pre.tcl2py.html#opstool.pre.tcl2py>`_
For details, see:
`model.py <https://github.com/yexiang1992/opstool/blob/master/docs/examples/post/SSI-GUQUAN/model.py>`_

.. GENERATED FROM PYTHON SOURCE LINES 14-23

.. code-block:: Python

    import matplotlib.pyplot as plt
    import openseespy.opensees as ops
    from utils.SSI_Gu_model import Model

    import opstool as opst
    import opstool.vis.pyvista as opsvis

    Model()








.. GENERATED FROM PYTHON SOURCE LINES 24-26

Visualize the model
-----------------------

.. GENERATED FROM PYTHON SOURCE LINES 26-29

.. code-block:: Python

    fig = opst.vis.pyvista.plot_model()
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_001.png
        :alt: ex ssi Gu
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-ssi-Gu_001.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    Widget(value='<iframe src="http://localhost:54458/index.html?ui=P_0x21b8bf44380_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 30-32

Gravity analysis
-----------------------

.. GENERATED FROM PYTHON SOURCE LINES 32-42

.. code-block:: Python

    ops.constraints("Transformation")
    ops.numberer("RCM")
    ops.test("NormDispIncr", 1e-06, 25, 2)
    ops.integrator("LoadControl", 1, 1, 1, 1)
    ops.algorithm("Newton")
    ops.system("BandGeneral")
    ops.analysis("Static")
    ops.analyze(3)
    print("soil gravity nonlinear analysis completed ...")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    soil gravity nonlinear analysis completed ...




.. GENERATED FROM PYTHON SOURCE LINES 43-45

Earthquake analysis
-----------------------

.. GENERATED FROM PYTHON SOURCE LINES 45-48

.. code-block:: Python

    ops.timeSeries("Path", 1, "-dt", 0.01, "-filePath", "utils/elcentro.txt", "-factor", 3)
    ops.pattern("UniformExcitation", 1, 1, "-accel", 1)








.. GENERATED FROM PYTHON SOURCE LINES 49-58

.. code-block:: Python

    ops.wipeAnalysis()
    ops.constraints("Transformation")
    ops.test("NormDispIncr", 1e-06, 25)
    ops.algorithm("Newton")
    ops.numberer("RCM")
    ops.system("BandGeneral")
    ops.integrator("Newmark", 0.55, 0.275625)
    ops.analysis("Transient")








.. GENERATED FROM PYTHON SOURCE LINES 59-70

.. code-block:: Python

    ODB = opst.post.CreateODB(
        odb_tag=1,
        compute_mechanical_measures=True,  # compute stress measures, strain measures, etc.
        project_gauss_to_nodes="copy",  # project gauss point responses to nodes, optional ["copy", "average", "extrapolate"]
    )  # Create ODB object

    for _ in range(2400):
        ops.analyze(1, 0.005)
        ODB.fetch_response_step()  # Fetch response for the current step
    ODB.save_response(zlib=True)  # Save response





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  All responses data with _odb_tag = 1 saved in G:\opstool\docs\.opstool.output/RespStepData-1.nc!




.. GENERATED FROM PYTHON SOURCE LINES 71-75

Post-processing
-----------------------
Frame Element Response
++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 75-78

.. code-block:: Python


    FrameResp = opst.post.get_element_responses(odb_tag=1, ele_type="Frame")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading Frame response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...




.. GENERATED FROM PYTHON SOURCE LINES 79-85

.. code-block:: Python

    f = FrameResp["sectionForces"].sel(eleTags=7, secDofs="MZ", secPoints=1)
    d = FrameResp["sectionDeformations"].sel(eleTags=7, secDofs="MZ", secPoints=1)

    plt.plot(d, f)
    plt.show()




.. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_002.png
   :alt: ex ssi Gu
   :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 86-88

Nodal response
+++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 88-91

.. code-block:: Python


    NodalResp = opst.post.get_nodal_responses(odb_tag=1)





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading all response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...




.. GENERATED FROM PYTHON SOURCE LINES 92-98

.. code-block:: Python

    time = NodalResp.time
    disp = NodalResp["disp"].sel(nodeTags=1, DOFs="UX")

    plt.plot(time, disp)
    plt.show()




.. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_003.png
   :alt: ex ssi Gu
   :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_003.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 99-101

Plane Soil Element
++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 101-104

.. code-block:: Python


    PlaneResp = opst.post.get_element_responses(odb_tag=1, ele_type="Plane")





.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading Plane response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...




.. GENERATED FROM PYTHON SOURCE LINES 105-114

.. code-block:: Python

    s = PlaneResp["Stresses"].sel(eleTags=37, GaussPoints=1, stressDOFs="sigma12")
    e = PlaneResp["Strains"].sel(eleTags=37, GaussPoints=1, strainDOFs="eps12")

    plt.plot(e, s, c="blue")
    plt.xlabel("eps12")
    plt.ylabel("sigma12")
    plt.title("Stress-Strain Curve for Plane Element 37 at Gauss Point 1")
    plt.show()




.. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_004.png
   :alt: Stress-Strain Curve for Plane Element 37 at Gauss Point 1
   :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_004.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 115-117

Plotting the nodal responses with deformed shape
+++++++++++++++++++++++++++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 117-126

.. code-block:: Python


    opsvis.set_plot_props(
        cmap="Spectral_r",
        point_size=0.0,
        notebook=True,
        scalar_bar_kargs={"title_font_size": 12, "label_font_size": 12, "position_x": 0.865},
        show_mesh_edges=False,
    )








.. GENERATED FROM PYTHON SOURCE LINES 127-139

.. code-block:: Python

    fig = opst.vis.pyvista.plot_nodal_responses(
        odb_tag=1,
        slides=False,
        step="absMax",
        resp_type="disp",
        resp_dof=("UX", "UY"),
        show_defo=True,
        defo_scale=5,
        show_undeformed=True,
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_005.png
        :alt: ex ssi Gu
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_005.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-ssi-Gu_005.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...
    Widget(value='<iframe src="http://localhost:54458/index.html?ui=P_0x21b8e8bb1a0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 140-142

Plotting the plane element stresses
+++++++++++++++++++++++++++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 142-155

.. code-block:: Python

    fig = opst.vis.pyvista.plot_unstruct_responses(
        odb_tag=1,
        slides=False,
        step="absMax",
        ele_type="Plane",
        resp_type="StressesAtNodes",
        resp_dof="sigma_vm",
        show_defo=True,
        defo_scale="auto",
        show_model=True,
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_006.png
        :alt: ex ssi Gu
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_006.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-ssi-Gu_006.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...
    Widget(value='<iframe src="http://localhost:54458/index.html?ui=P_0x21b957a7dd0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 156-158

Plotting the deformation animation
+++++++++++++++++++++++++++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 158-170

.. code-block:: Python


    fig = opst.vis.pyvista.plot_nodal_responses_animation(
        odb_tag=1,
        framerate=50,  # Frames per second
        resp_type="disp",
        resp_dof=("UX", "UY"),
        show_defo=True,
        defo_scale=5,
        savefig="images/nodal_disp_animation_ssi.mp4",
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_007.png
        :alt: ex ssi Gu
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_007.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-ssi-Gu_007.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...
    Animation has been saved to images/nodal_disp_animation_ssi.mp4!
    Widget(value='<iframe src="http://localhost:54458/index.html?ui=P_0x21b83153ce0_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 172-173

Clean up

.. GENERATED FROM PYTHON SOURCE LINES 173-175

.. code-block:: Python

    fig.close()








.. GENERATED FROM PYTHON SOURCE LINES 176-189

.. code-block:: Python

    fig = opst.vis.pyvista.plot_unstruct_responses_animation(
        odb_tag=1,
        framerate=50,  # Frames per second
        ele_type="Plane",
        resp_type="StressesAtNodes",
        resp_dof="sigma_vm",
        show_defo=True,
        defo_scale=10,
        show_model=True,
        savefig="images/stress_animation_ssi.mp4",
    )
    fig.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_008.png
        :alt: ex ssi Gu
        :srcset: /auto_examples/examples/postprocessing/images/sphx_glr_ex-ssi-Gu_008.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: G:\opstool\docs\auto_examples\examples\postprocessing\images\sphx_glr_ex-ssi-Gu_008.vtksz



.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    OPSTOOL ::  Loading response data from G:\opstool\docs\.opstool.output/RespStepData-1.nc ...
    Animation has been saved as images/stress_animation_ssi.mp4!
    Widget(value='<iframe src="http://localhost:54458/index.html?ui=P_0x21b82ee6510_0&reconnect=auto" class="pyvista" style="width: 99%; height: 600px; border: 1px solid rgb(221,221,221);"></iframe>')




.. GENERATED FROM PYTHON SOURCE LINES 190-191

Clean up

.. GENERATED FROM PYTHON SOURCE LINES 191-192

.. code-block:: Python

    fig.close()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (2 minutes 14.577 seconds)


.. _sphx_glr_download_auto_examples_examples_postprocessing_ex-ssi-Gu.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: ex-ssi-Gu.ipynb <ex-ssi-Gu.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: ex-ssi-Gu.py <ex-ssi-Gu.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: ex-ssi-Gu.zip <ex-ssi-Gu.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
